<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Room</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">Chat Room</h1>
        <input type="text" id="username" class="form-control mb-3" placeholder="Enter Username" />
        <input type="text" id="message" class="form-control mb-3" placeholder="Enter Message" />
        <button id="sendBtn" class="btn btn-primary w-100">Send</button>
        <ul id="textMsg" class="list-unstyled mt-4 p-3 border bg-white" style="max-height: 400px; overflow-y: auto;"></ul>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
    
        const roomId = window.location.pathname.split('/').pop(); 
        const sendBtn = document.getElementById('sendBtn');
        const usernameInput = document.getElementById('username');
        const messageInput = document.getElementById('message');
        const messages = document.getElementById('textMsg');
    
        socket.emit('join-room', roomId);
    
        function sendMessage() {
            const username = usernameInput.value.trim();
            const message = messageInput.value.trim();
    
            if (username && message) {
                socket.emit('message', { roomId, username, message });
                messageInput.value = ''; 
            } else {
                alert('Username and message cannot be empty!');
            }
        }
    
        sendBtn.addEventListener('click', sendMessage);
    
        messageInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); 
                sendMessage();
            }
        });
    
        socket.on('load-messages', (chatHistory) => {
            messages.innerHTML = '';
            chatHistory.forEach(({ username, message, timestamp }) => {
                appendMessage(username, message, timestamp);
            });
        });
    
        socket.on('message', ({ username, message, timestamp }) => {
            appendMessage(username, message, timestamp);
        });
    
        function appendMessage(username, message, timestamp) {
            const li = document.createElement('li');
            li.className = 'mb-2 p-2 border rounded bg-light';
            li.innerHTML = `<strong class="text-primary fs-5">${username}</strong> <span class="text-muted fs-6">[${timestamp}]</span> <div class="fw-semibold">  ${message}</div>`;
            messages.appendChild(li);
        }
    </script>
    
    
</body>
</html>
